note *
note * This build file is in the Make Abstract Machine (MAM) language. It was
note * first generated by nmake, but in the ksh 93u+m distribution we maintain
note * it manually because nmake had too many problems to keep using. The
note * Mamfiles are processed by mamake (src/cmd/INIT/mamake.c); we added
note * indentation to improve readability. The language is documented in
note * src/cmd/INIT/README-mamake.md.
note *
setv MAMAKE_STRICT
setv INSTALLROOT ../../..
setv PACKAGE_ast_INCLUDE ${INSTALLROOT}/include/ast
setv AR ${mam_cc_AR} ${mam_cc_AR_ARFLAGS}
setv CC cc
setv mam_cc_FLAGS ${mam_cc_DLL}
setv CCFLAGS ${-debug-symbols?1?${mam_cc_DEBUG} -D_BLD_DEBUG?${mam_cc_OPTIMIZE}?}
setv IFFEFLAGS
setv LDFLAGS
make install virtual
	make dll virtual
		make dll.req
			prev ${INSTALLROOT}/bin/mkreq
			exec - mkreq ${CC} ${mam_cc_FLAGS} ${CCFLAGS} : ${LDFLAGS} : dll dl dld ast
		done
		make libdll.a
			make dlfcn.o
				make dlfcn.c
					prev dll.h implicit dontcare virtual
					prev xcoff.h implicit dontcare virtual
					prev dl.h implicit dontcare virtual
					make ${PACKAGE_ast_INCLUDE}/error.h implicit
						make ${PACKAGE_ast_INCLUDE}/option.h implicit
							make ${PACKAGE_ast_INCLUDE}/ast.h implicit
								prev ${PACKAGE_ast_INCLUDE}/ast_api.h implicit
								make ${PACKAGE_ast_INCLUDE}/vmalloc.h implicit
									make ${PACKAGE_ast_INCLUDE}/ast_common.h implicit
										prev ${PACKAGE_ast_INCLUDE}/ast_map.h implicit
										make ${PACKAGE_ast_INCLUDE}/endian.h implicit
											make ${PACKAGE_ast_INCLUDE}/bytesex.h implicit
												prev ${PACKAGE_ast_INCLUDE}/ast_common.h
											done
										done
									done
									make ${PACKAGE_ast_INCLUDE}/ast_std.h implicit
										make ${PACKAGE_ast_INCLUDE}/regex.h implicit
											prev ${PACKAGE_ast_INCLUDE}/ast_api.h
											make ${PACKAGE_ast_INCLUDE}/ast_wchar.h implicit
												make ${PACKAGE_ast_INCLUDE}/wctype.h implicit
													make ${PACKAGE_ast_INCLUDE}/ast_wctype.h implicit
														prev ${PACKAGE_ast_INCLUDE}/endian.h
														make ${PACKAGE_ast_INCLUDE}/wchar.h implicit
															prev ${PACKAGE_ast_INCLUDE}/ast_wchar.h
														done
													done
												done
												make ${PACKAGE_ast_INCLUDE}/stdio.h implicit
													make ${PACKAGE_ast_INCLUDE}/ast_stdio.h implicit
														prev ${PACKAGE_ast_INCLUDE}/sfio_s.h implicit
														prev ${PACKAGE_ast_INCLUDE}/ast_std.h
													done
												done
												prev ${PACKAGE_ast_INCLUDE}/ast_common.h
											done
											prev ${PACKAGE_ast_INCLUDE}/ast_common.h
										done
										make ${PACKAGE_ast_INCLUDE}/getopt.h implicit
											prev ${PACKAGE_ast_INCLUDE}/ast_getopt.h implicit
										done
										prev ${PACKAGE_ast_INCLUDE}/ast_map.h
										prev ${PACKAGE_ast_INCLUDE}/ast_botch.h implicit
										prev ${PACKAGE_ast_INCLUDE}/ast_limits.h implicit
										make ${PACKAGE_ast_INCLUDE}/ast_fcntl.h implicit
											prev ${PACKAGE_ast_INCLUDE}/ast_fs.h implicit
										done
										prev ${PACKAGE_ast_INCLUDE}/ast_getopt.h
										make ${PACKAGE_ast_INCLUDE}/ast_sys.h implicit
											prev ${PACKAGE_ast_INCLUDE}/getopt.h
											prev ${PACKAGE_ast_INCLUDE}/endian.h
										done
										prev ${PACKAGE_ast_INCLUDE}/ast_lib.h implicit
										prev ${PACKAGE_ast_INCLUDE}/ast_common.h
									done
								done
								make ${PACKAGE_ast_INCLUDE}/sfio.h implicit
									prev ${PACKAGE_ast_INCLUDE}/sfio_s.h
									prev ${PACKAGE_ast_INCLUDE}/ast_common.h
									prev ${PACKAGE_ast_INCLUDE}/ast_std.h
								done
								prev ${PACKAGE_ast_INCLUDE}/ast_std.h
							done
						done
						prev ${PACKAGE_ast_INCLUDE}/ast.h
					done
					make dlldefs.h implicit
						make FEATURE/dll
							prev features/dll
							bind -ldl dontcare
							bind -last
							exec - iffe ${IFFEFLAGS} -v -c "${CC} ${mam_cc_FLAGS} ${CCFLAGS} ${LDFLAGS}" ref ${mam_cc_L+-L.} ${mam_cc_L+-L${INSTALLROOT}/lib} -I${PACKAGE_ast_INCLUDE} -I${INSTALLROOT}/include ${mam_libdl} ${mam_libast} : run ${<}
						done
						exec - cp -f ${<} ${@}
					done
					prev ${PACKAGE_ast_INCLUDE}/ast.h
				done dlfcn.c
				exec - ${CC} ${mam_cc_FLAGS} ${CCFLAGS} -I. -I${PACKAGE_ast_INCLUDE} -D_BLD_dll -c ${<}
			done dlfcn.o
			make dllopen.o
				make dllopen.c
					make dlllib.h implicit
						prev ${PACKAGE_ast_INCLUDE}/error.h
						prev dlldefs.h
						prev ${PACKAGE_ast_INCLUDE}/ast.h
					done
				done
				exec - ${CC} ${mam_cc_FLAGS} ${CCFLAGS} -I. -I${PACKAGE_ast_INCLUDE} -D_BLD_dll -c ${<}
			done
			make dllfind.o
				make dllfind.c
					prev ${PACKAGE_ast_INCLUDE}/error.h
					prev dlldefs.h
					prev ${PACKAGE_ast_INCLUDE}/ast.h
				done
				exec - ${CC} ${mam_cc_FLAGS} ${CCFLAGS} -I. -I${PACKAGE_ast_INCLUDE} -D_BLD_dll -c ${<}
			done
			make dllplug.o
				make dllplug.c
					prev dlllib.h
				done
				exec - ${CC} ${mam_cc_FLAGS} ${CCFLAGS} -I. -I${PACKAGE_ast_INCLUDE} -D_BLD_dll -c ${<}
			done
			make dll_lib.o
				make dll_lib.c
					prev dlllib.h
				done
				exec - ${CC} ${mam_cc_FLAGS} ${CCFLAGS} -I. -I${PACKAGE_ast_INCLUDE} -D_BLD_dll -c ${<}
			done
			make dllnext.o
				make dllnext.c
					prev rld_interface.h implicit dontcare virtual
					prev dlldefs.h
					prev ${PACKAGE_ast_INCLUDE}/ast.h
				done
				exec - ${CC} ${mam_cc_FLAGS} ${CCFLAGS} -I. -I${PACKAGE_ast_INCLUDE} -D_BLD_dll -c ${<}
			done
			make dlllook.o
				make dlllook.c
					prev dlldefs.h
					prev ${PACKAGE_ast_INCLUDE}/error.h
					prev ${PACKAGE_ast_INCLUDE}/ast.h
				done
				exec - ${CC} ${mam_cc_FLAGS} ${CCFLAGS} -I. -I${PACKAGE_ast_INCLUDE} -D_BLD_dll -c ${<}
			done
			make dllscan.o
				make dllscan.c
					prev dlldefs.h
					prev ${PACKAGE_ast_INCLUDE}/vmalloc.h
					make ${PACKAGE_ast_INCLUDE}/fts.h implicit
						prev ${PACKAGE_ast_INCLUDE}/ast_mode.h implicit
						prev ${PACKAGE_ast_INCLUDE}/ast_fs.h
						prev ${PACKAGE_ast_INCLUDE}/ast_std.h
					done
					prev ${PACKAGE_ast_INCLUDE}/error.h
					prev ${PACKAGE_ast_INCLUDE}/endian.h
					make ${PACKAGE_ast_INCLUDE}/cdt.h implicit
						prev ${PACKAGE_ast_INCLUDE}/ast_common.h
						prev ${PACKAGE_ast_INCLUDE}/ast_std.h
					done
					prev ${PACKAGE_ast_INCLUDE}/ast.h
				done
				exec - ${CC} ${mam_cc_FLAGS} ${CCFLAGS} ${-debug-symbols?1?${mam_cc_DEBUG} -D_BLD_DEBUG?${CCFLAGS.FORCE}?} -I. -I${PACKAGE_ast_INCLUDE} -D_BLD_dll -c ${<}
			done
			make dllcheck.o
				make dllcheck.c
					prev dlllib.h
				done
				exec - ${CC} ${mam_cc_FLAGS} ${CCFLAGS} -I. -I${PACKAGE_ast_INCLUDE} -D_BLD_dll -c ${<}
			done
			make dllerror.o
				make dllerror.c
					prev dlllib.h
				done
				exec - ${CC} ${mam_cc_FLAGS} ${CCFLAGS} -I. -I${PACKAGE_ast_INCLUDE} -D_BLD_dll -c ${<}
			done
			exec - if	test -f ${@}
			exec - then	${AR} rc ${@} ${?}  # add changed *.o
			exec - else	${AR} rc ${@} ${^}  # add all *.o
			exec - fi || exit
			exec - (ranlib ${@}) >/dev/null 2>&1 || true
		done libdll.a
	done dll
	prev libdll.a
	make ${INSTALLROOT}/lib
		exec - mkdir -p ${@}
	done
	make ${INSTALLROOT}/lib/libdll.a
		prev libdll.a
		exec - cp -f ${<} ${@} || exit
		exec - (ranlib ${@}) >/dev/null 2>&1 || true
	done
	make ${INSTALLROOT}/lib/lib
		exec - mkdir -p ${@}
	done
	make ${INSTALLROOT}/lib/lib/dll
		prev dll.req
		exec - cp -f ${<} ${@}
	done
	make ${PACKAGE_ast_INCLUDE}
		exec - mkdir -p ${PACKAGE_ast_INCLUDE}
	done
	make ${PACKAGE_ast_INCLUDE}/dlldefs.h
		prev dlldefs.h
		exec - cp -f ${<} ${@}
	done
done install
make test dontcare virtual
done test
